과제후기

스레드를 어떻게 처리하면 좋을까에 대해서 고민을 되게 많이 했다.

많은 데이터에서 멀티 스레드를 이용하여 데이터를 검색하고

정제된 데이터를 DB에 저장해야 하는데, DTO에 정제된 데이터를 담고 보내야 하지만,

동기화 문제로 오류가 생기지 않을까 했다.

크롤링 하는 스레드, 데이터를 정제하는 멀티 스레드, db에 저장하는 스레드가 있는데

Synchronized를 사용하면 멀티 스레드가 의미가 사라진다. 이를 해결할 방법을 생각했다.

그러나, 내부에서 진행되는 과정은 지연이 없는지 동기화 이슈가 발생하지는 않았다.

이후 동기화 이슈는 데이터 베이스에 통신을 여러번 진행할 때 발생하였다.

SELECT -> 저장 -> 업데이트 -> SELECT -> 저장의 과정을 쓰레드로 만들어서 진행하였는데

저장되는 과정에서 DB연산 중 변경되지 않은 값을 저장을 하여 기대값과 결과값이 달라졌다.

synchronized를 사용해도 제어가 되지 않아 결국 자바에서 제공하는 Excutor를 사용하였다.

이는 스레드가 완전히 끝날 때 까지 다른 스레드에 Lock을 걸기 때문에 동기화 이슈가 해결되었다.

다음 문제는 GPS 기능 사용시 프레임 스킵 문제가 발생하였다.

GPS API를 구글 검색해서 가져왔는데, 경도와 위도로 위치 값을 가져오는 함수를

UI에서 처리하게 만들어 놓아서 이 때문에 프레임 스킵 문제가 발생하였다.

스레드로 처리하여도 안 되고 인텐트를 사용해서 백그라운드로 보내야 사용할 수 있다고 하여서

구글에서 예시로 제공하는 코드를 참조하여 백그라운드로 보내고 리시버를 이용하여 값의 변화를 감지하게 끔 하였다.

그러나 리시버가 detected되서 그런지 몰라도 기능이 불안정하여 최신 백그라운드 기술인 WorkerManager를 사용하였다.

WorkerManager를 사용하는데 옵저버 패턴, 라이프 사이클, 람다식 등 알아야할 게 너무 많아졌고

Service와 excutor로 백그라운드를 구현하고 책을 참조하여 리시버를 통해 값을 받는 걸로 만들었다.

위젯에 새로고침을 구현하려 했으나 액티비티를 기준으로 하여 프로그램을 짜서

액티비티에서 새로고침을 하고 위젯에 결과가 반영되게 구현하였다.